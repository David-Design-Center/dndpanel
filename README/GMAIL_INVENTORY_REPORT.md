# Gmail Module Inventory Report
## Complete Analysis of Extracted Code vs gapiService.ts

---

## üìä CURRENT STATE SUMMARY

| Metric | Count |
|--------|-------|
| **Total files in gmail/** | 11 |
| **Total lines in gmail/** | 2,050 |
| **Exported functions in gmail/** | 20 |
| **Exported functions in gapiService** | 41 |
| **Functions needing integration** | 21 |

---

## ‚úÖ ALREADY EXTRACTED & WORKING

### 1. **gmail/send/compose.ts** (664 lines) ‚úÖ
**Status**: CREATED & INTEGRATED (Phase 5)

Exported functions:
- `sendGmailMessage()` - Send email via Gmail
- `saveGmailDraft()` - Save draft in Gmail

Status in gapiService:
- Imported: ‚úÖ Yes
- Used as wrappers: ‚úÖ Yes
- Old implementations: ‚úÖ Renamed to `_legacy_*`

---

### 2. **gmail/fetch/messages.ts** (281 lines) ‚úÖ
**Status**: CREATED but NOT INTEGRATED (Phase 4)

Exported functions:
- `fetchGmailMessages()` - List messages with pagination
- `fetchGmailMessageById()` - Fetch single message
- `fetchLatestMessageInThread()` - Get latest in thread
- `fetchThreadMessages()` - Get all messages in thread
- `PaginatedEmailResponse` - Interface

Status in gapiService:
- Imported: ‚ùå No
- Used as wrappers: ‚ùå No
- Old implementations: ‚úÖ Still exist (lines 924-1311)
- Duplicated code: ‚úÖ Yes (~387 lines)

**ACTION**: Replace with wrappers to delegate to module

---

### 3. **gmail/operations/attachments.ts** (72 lines) ‚úÖ
**Status**: CREATED but NOT INTEGRATED (Phase 4)

Exported functions:
- `getAttachmentDownloadUrl()` - Download attachment handling

Status in gapiService:
- Imported: ‚ùå No
- Used as wrappers: ‚ùå No
- Old implementations: ‚úÖ Still exists (lines 1311-1477)
- Duplicated code: ‚úÖ Yes (~166 lines)

**ACTION**: Replace with wrapper to delegate to module

---

### 4. **gmail/operations/labels.ts** (184 lines) ‚úÖ
**Status**: CREATED but NOT INTEGRATED (Phase 4)

Exported functions:
- `fetchGmailLabels()` - Get all labels
- `fetchGmailMessagesByLabel()` - Get messages by label
- `createGmailLabel()` - Create new label

Status in gapiService:
- Imported: ‚ùå No
- Used as wrappers: ‚ùå No
- Old implementations: ‚úÖ Still exist (lines 2326-2501)
- Duplicated code: ‚úÖ Yes (~309 lines)

**ACTION**: Replace with wrappers to delegate to module

Note: gapiService also has:
- `updateGmailLabel()` - UPDATE label (not in module)
- `deleteGmailLabel()` - DELETE label (not in module)
- `applyGmailLabels()` - Apply labels to message (not in module)

---

### 5. **gmail/parsing/charset.ts** (186 lines) ‚úÖ
**Status**: CREATED & EXPORTED (Phase 2)

Exported functions:
- `extractCharsetFromPart()` - Extract charset from email part
- `decodeWithFallbacks()` - Decode with fallback charsets
- `decodeHtmlEntities()` - Decode HTML entities

Status in gapiService:
- Used directly: ‚úÖ Yes (imported from gmail module)
- Still in gapiService: ‚ùå No (good!)

---

### 6. **gmail/parsing/headers.ts** (124 lines) ‚úÖ
**Status**: CREATED & EXPORTED (Phase 2)

Exported functions:
- `parseHeaders()` - Parse email headers
- `decodeRfc2047()` - Decode RFC 2047 encoded headers
- `parseEmailAddresses()` - Parse email address strings
- `getHeaderValue()` - Get header value by name
- `getRecipients()` - Get recipient list

Status in gapiService:
- Used directly: ‚úÖ Yes (imported from gmail module)
- Still in gapiService: ‚ùå No (good!)

---

### 7. **gmail/parsing/body.ts** (91 lines) ‚úÖ
**Status**: CREATED & EXPORTED (Phase 1)

Exported functions:
- `extractTextFromPart()` - Extract text from email part
- `findBodyPart()` - Find body part in email structure

Status in gapiService:
- Used directly: ‚úÖ Yes (imported from gmail module)
- Still in gapiService: ‚ùå No (good!)

---

### 8. **gmail/parsing/index.ts** (143 lines) ‚úÖ
**Status**: CREATED & EXPORTED (Phase 3)

Exported functions:
- `extractAttachments()` - Extract attachments from payload
- `extractInlineImages()` - Extract inline images
- `getMimeStructure()` - Get MIME structure

Status in gapiService:
- Used directly: ‚úÖ Yes (imported from gmail module)
- Still in gapiService: ‚ùå No (good!)

---

### 9. **gmail/utils/base64.ts** (75 lines) ‚úÖ
**Status**: CREATED & EXPORTED (Utilities)

Exported functions:
- `base64UrlDecode()` - Decode base64url
- `decodeBase64UrlToBytes()` - Decode to bytes
- `decodeQuotedPrintableToBytes()` - Decode quoted-printable
- `base64UrlEncode()` - Encode to base64url

Status in gapiService:
- Used directly: ‚úÖ Yes (imported from gmail module)
- Still in gapiService: ‚ùå No (good!)

---

### 10. **gmail/types.ts** (56 lines) ‚úÖ
**Status**: CREATED & EXPORTED (Type definitions)

Exported types:
- `EmailPart` - Email part structure
- `GmailMessage` - Gmail message format
- `ParsedEmail` - Parsed email format
- `CharsetDetectionResult` - Charset detection result

Status in gapiService:
- Used directly: ‚úÖ Yes (imported from gmail module)
- Still in gapiService: ‚ùå No (good!)

---

### 11. **gmail/index.ts** (59 lines) ‚úÖ
**Status**: CENTRAL EXPORT HUB (Phase 0)

Re-exports all public APIs from gmail modules
Consolidates all exports for easy importing

---

## üî¥ NOT YET EXTRACTED (Still in gapiService.ts only)

### Category 1: Message Mutations (169 lines)
**Status**: NOT EXTRACTED - Needs new module

Functions in gapiService (lines 2611-2780):
1. `markGmailMessageAsTrash()` - Move to trash
2. `markGmailMessageAsRead()` - Mark as read
3. `markGmailMessageAsUnread()` - Mark as unread
4. `markGmailMessageAsStarred()` - Mark as starred
5. `markGmailMessageAsUnstarred()` - Mark as unstarred
6. `markGmailMessageAsImportant()` - Mark as important
7. `markGmailMessageAsUnimportant()` - Mark as unimportant

**Suggested module**: `gmail/operations/mutations.ts` (170 lines)

**Why**: All follow same pattern - update message flags/labels

---

### Category 2: Label Management Extensions (102 lines)
**Status**: PARTIALLY EXTRACTED - Missing functions

In gmail/operations/labels.ts:
- ‚úÖ `fetchGmailLabels()`
- ‚úÖ `fetchGmailMessagesByLabel()`
- ‚úÖ `createGmailLabel()`

NOT in module (in gapiService only):
- ‚ùå `updateGmailLabel()` (47 lines, line 2501)
- ‚ùå `deleteGmailLabel()` (32 lines, line 2548)
- ‚ùå `applyGmailLabels()` (31 lines, line 2580)

**Action**: Add these 3 functions to `gmail/operations/labels.ts`

---

### Category 3: Filter Management (84 lines)
**Status**: NOT EXTRACTED - Needs new module

Functions in gapiService (lines 2962-3046):
1. `listGmailFilters()` - List all filters
2. `getGmailFilter()` - Get single filter
3. `createGmailFilter()` - Create new filter
4. `deleteGmailFilter()` - Delete filter

**Suggested module**: `gmail/operations/filters.ts` (85 lines)

**Why**: Related filter operations, separate from labels

---

### Category 4: Contacts & Profile (182 lines)
**Status**: NOT EXTRACTED - Needs new module

Functions in gapiService (lines 2780-2962):
1. `getGmailUserProfile()` - Get user profile info
2. `testPeopleAPI()` - Test People API (debug)
3. `fetchPeopleConnections()` - Fetch People API contacts
4. `fetchOtherContacts()` - Fetch other contacts

**Suggested module**: `gmail/contacts/profile.ts` (185 lines)

**Why**: People API operations, separate concern from email

---

### Category 5: Special Helper Functions (171 lines)
**Status**: NOT EXTRACTED - Specific to gapiService

Functions in gapiService (lines 1477-1648):
1. `processInlineImages()` - Process inline images from email

**Status**: KEEP IN gapiService
**Reason**: Highly specific to email rendering, tightly coupled with viewing logic

---

### Category 6: Cleanup & Utilities (55 lines)
**Status**: NOT EXTRACTED - Low priority

Functions in gapiService (lines 3046-3101):
1. `emptyGmailTrash()` - Empty trash folder

**Suggested module**: Could go to `gmail/operations/trash.ts` OR `gmail/misc/trash.ts`
**Priority**: LOW (rarely used)

---

### Category 7: Authentication & Core (379 lines)
**Status**: MUST STAY IN gapiService - Core functionality

Functions in gapiService (lines 154-540):
1. `initGapiClient()` - Initialize Google APIs
2. `isGmailSignedIn()` - Check auth status
3. `signInToGmail()` - OAuth sign-in
4. `signInToGmailWithOAuth()` - OAuth with GIS
5. `signOutFromGmail()` - Sign out
6. `clearCurrentAccessToken()` - Clear token
7. `setAccessToken()` - Set token
8. `getCurrentAccessToken()` - Get token

**Reason**: 
- Core to GAPI initialization
- Manages OAuth tokens
- Required for all operations
- Cannot be extracted without breaking everything

---

## üìã EXTRACTION PRIORITY & EFFORT MATRIX

### Phase 6: INTEGRATE EXISTING PHASE 4 MODULES (30 min)
**Priority**: IMMEDIATE - Finish what was started

| Module | Function | In gapiService | In gmail/ | Action |
|--------|----------|---|---|--------|
| fetch/messages | fetchGmailMessages | ‚úÖ (116 lines) | ‚úÖ (impl) | Create wrapper |
| fetch/messages | fetchGmailMessageById | ‚úÖ (186 lines) | ‚úÖ (impl) | Create wrapper |
| fetch/messages | fetchLatestMessageInThread | ‚úÖ (38 lines) | ‚úÖ (impl) | Create wrapper |
| fetch/messages | fetchThreadMessages | ‚úÖ (47 lines) | ‚úÖ (impl) | Create wrapper |
| operations/attachments | getAttachmentDownloadUrl | ‚úÖ (166 lines) | ‚úÖ (impl) | Create wrapper |
| operations/labels | fetchGmailLabels | ‚úÖ (104 lines) | ‚úÖ (impl) | Create wrapper |
| operations/labels | fetchGmailMessagesByLabel | ‚úÖ (26 lines) | ‚úÖ (impl) | Create wrapper |
| operations/labels | createGmailLabel | ‚úÖ (45 lines) | ‚úÖ (impl) | Create wrapper |
| **Total Removed** | | **728 lines** | | |

---

### Phase 7: COMPLETE LABELS MODULE (15 min)
**Priority**: HIGH - Finish incomplete extraction

| Function | In gapiService | In gmail/ | Action |
|----------|---|---|--------|
| updateGmailLabel | ‚úÖ (47 lines) | ‚ùå Missing | Add to labels.ts |
| deleteGmailLabel | ‚úÖ (32 lines) | ‚ùå Missing | Add to labels.ts |
| applyGmailLabels | ‚úÖ (31 lines) | ‚ùå Missing | Add to labels.ts |
| **Total to Add** | **110 lines** | | |

---

### Phase 8: EXTRACT MUTATIONS MODULE (30 min)
**Priority**: HIGH - Common operations

| Function | In gapiService | Create in | Action |
|----------|---|---|--------|
| markGmailMessageAsRead | ‚úÖ (26 lines) | mutations.ts | Move + wrapper |
| markGmailMessageAsUnread | ‚úÖ (26 lines) | mutations.ts | Move + wrapper |
| markGmailMessageAsStarred | ‚úÖ (24 lines) | mutations.ts | Move + wrapper |
| markGmailMessageAsUnstarred | ‚úÖ (24 lines) | mutations.ts | Move + wrapper |
| markGmailMessageAsImportant | ‚úÖ (21 lines) | mutations.ts | Move + wrapper |
| markGmailMessageAsUnimportant | ‚úÖ (21 lines) | mutations.ts | Move + wrapper |
| markGmailMessageAsTrash | ‚úÖ (27 lines) | mutations.ts | Move + wrapper |
| **Total to Extract** | **169 lines** | | |

---

### Phase 9: EXTRACT FILTERS MODULE (15 min)
**Priority**: MEDIUM - Less common but organized

| Function | In gapiService | Create in | Action |
|----------|---|---|--------|
| listGmailFilters | ‚úÖ (20 lines) | filters.ts | Move + wrapper |
| getGmailFilter | ‚úÖ (20 lines) | filters.ts | Move + wrapper |
| createGmailFilter | ‚úÖ (25 lines) | filters.ts | Move + wrapper |
| deleteGmailFilter | ‚úÖ (19 lines) | filters.ts | Move + wrapper |
| **Total to Extract** | **84 lines** | | |

---

### Phase 10: EXTRACT CONTACTS MODULE (15 min)
**Priority**: MEDIUM - Separate API integration

| Function | In gapiService | Create in | Action |
|----------|---|---|--------|
| getGmailUserProfile | ‚úÖ (49 lines) | contacts/profile.ts | Move + wrapper |
| testPeopleAPI | ‚úÖ (54 lines) | contacts/profile.ts | Move + wrapper |
| fetchPeopleConnections | ‚úÖ (41 lines) | contacts/profile.ts | Move + wrapper |
| fetchOtherContacts | ‚úÖ (38 lines) | contacts/profile.ts | Move + wrapper |
| **Total to Extract** | **182 lines** | | |

---

### Phase 11: EXTRACT MISC UTILITIES (5 min)
**Priority**: LOW - Nice to have

| Function | In gapiService | Create in | Action |
|----------|---|---|--------|
| emptyGmailTrash | ‚úÖ (55 lines) | misc/trash.ts | Move + wrapper |
| **Total to Extract** | **55 lines** | | |

---

## üéØ COMPLETE EXTRACTION ROADMAP

### Current State
```
gapiService.ts: 3,102 lines
gmail/: 2,050 lines (11 files)
```

### Phase 6: Integrate Phase 4 (30 min)
```
gapiService: 3,102 - 728 = 2,374 lines ‚¨áÔ∏è
gmail/: 2,050 lines (no new files)
```

### Phase 7: Complete Labels (15 min)
```
gapiService: 2,374 - 110 = 2,264 lines ‚¨áÔ∏è
gmail/operations/labels.ts: +110 lines ‚ûï
```

### Phase 8: Extract Mutations (30 min)
```
gapiService: 2,264 - 169 = 2,095 lines ‚¨áÔ∏è
NEW: gmail/operations/mutations.ts: 170 lines ‚ú®
```

### Phase 9: Extract Filters (15 min)
```
gapiService: 2,095 - 84 = 2,011 lines ‚¨áÔ∏è
NEW: gmail/operations/filters.ts: 85 lines ‚ú®
```

### Phase 10: Extract Contacts (15 min)
```
gapiService: 2,011 - 182 = 1,829 lines ‚¨áÔ∏è
NEW: gmail/contacts/profile.ts: 185 lines ‚ú®
```

### Phase 11: Extract Misc (5 min)
```
gapiService: 1,829 - 55 = 1,774 lines ‚¨áÔ∏è
NEW: gmail/misc/trash.ts: 55 lines ‚ú®
```

### Final State
```
gapiService.ts: 1,774 lines (43% reduction from 3,102!)
gmail/: 2,505 lines (17 files total)

Keep in gapiService:
‚îú‚îÄ Auth/Init (~379 lines)
‚îú‚îÄ Wrappers (~150 lines)
‚îú‚îÄ processInlineImages (~171 lines)
‚îú‚îÄ Misc helpers (~100 lines)
‚îî‚îÄ Type defs (~50 lines)
```

---

## üìä COMPREHENSIVE EXTRACTION SUMMARY

### By the Numbers
```
Total lines to extract: 1,328 lines
Total new modules: 5
Total wrapper functions: 21
Time to complete: 110 minutes (1 hour 50 minutes)
Final gapiService size: 1,774 lines
Total reduction: 43% ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
```

### Module Growth
```
BEFORE:
gmail/ (11 files, 2,050 lines)

AFTER:
gmail/ (17 files, 3,378 lines)
‚îú‚îÄ send/compose.ts (664) ‚úÖ
‚îú‚îÄ fetch/messages.ts (281) ‚úÖ
‚îú‚îÄ operations/
‚îÇ  ‚îú‚îÄ attachments.ts (72) ‚úÖ
‚îÇ  ‚îú‚îÄ labels.ts (294) - expanded
‚îÇ  ‚îú‚îÄ mutations.ts (170) ‚ú®
‚îÇ  ‚îî‚îÄ filters.ts (85) ‚ú®
‚îú‚îÄ contacts/
‚îÇ  ‚îî‚îÄ profile.ts (185) ‚ú®
‚îú‚îÄ parsing/ (540) ‚úÖ
‚îú‚îÄ misc/
‚îÇ  ‚îî‚îÄ trash.ts (55) ‚ú®
‚îî‚îÄ [other files] (208)
```

---

## ‚úÖ ACTION ITEMS

**What needs to be done?**

1. ‚úÖ Phase 4 modules exist and are created
2. ‚ùå Phase 6: Integrate Phase 4 wrappers (30 min)
3. ‚ùå Phase 7: Complete labels module (15 min)
4. ‚ùå Phase 8: Extract mutations module (30 min)
5. ‚ùå Phase 9: Extract filters module (15 min)
6. ‚ùå Phase 10: Extract contacts module (15 min)
7. ‚ùå Phase 11: Extract misc utilities (5 min)

**Total effort**: 110 minutes
**Total reduction**: 43% of gapiService

**Want to proceed?**
